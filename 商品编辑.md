## 商品编辑
<font color=#333333 size="3" >为用户提供在DSers平台商品编辑功能，可以修改商品的基本信息、Variant、价格、描述、图片。并上传至Shopify</font>
### 定义
<font color=#666666 size="2">
>
|   名词 | 定义 |
| ---- | ------ |
| DSers商品 | 在DSers通过导入功能导入的商品 |
| Shopify商品 | Shopify店铺中的商品 |
| AliExpress商品 | AliExpress平台供应商出售的商品 |
| Other商品 | 在DSers平台没有绑定AliExpress商品的商品，它可能是Shopify商品也可能只是DSers商品。 |
| 定时任务 | 由DSers发起，向Shopify或AliExpress请求数据 |
| Webhook | 由Shopify发起，向DSers发送订单、商品数据改动 |
| 首次同步 | 指新用户在首次绑定Shopify店铺时进行的数据同步 |
| Cost | 商品对应Variant在AliExpress需要支付的价格 |
| Price | 商品对应Variant在Shopify出售的价格 |
| Compare at Price | 商品对应Variant在Shopify展示的原价格 |
| SKU | 商品的规则对应的编号|
| Variants | 商品的规则分组，如 Red/xxl |
| Option | 商品的规则分组，由Option Value、Option Name组成，如 Color:red |
</font>

### 功能点说明
1. 商品编辑上线后变更说明：
   - 商品只能手动Publish to Shopify 而不可以在DSers手动offline。
   - 商品在Shopify删除时会触发该商品在DSers标记为未发布的商品。
   - 只有未发布的商品可以编辑，已发布的商品只能查看,查看与编辑页面相同，只是不可更改。

1. 可以编辑的商品：未发布到Shopify的商品。

2. 入口：图编辑入口。
<div align=center>![-w450](media/15524743733115/15525478545405.jpg)
<center><font size="2" color=#666666>编辑商品入口</font></center>
</div>

4. 触发编辑商品示意图：
  <div align=center>![-w438](media/15524743733115/15525557063119.jpg)
<center><font size="2" color=#666666>示意图</font></center>
</div></br>
1. 商品编辑后的保存：保存后不自动发布到Shopify，需要点击发布按钮发布，入口1在MyProduct页面-商品卡片上的发布按钮，入口2在商品编辑的全局Action中。

2. 商品排序：<font color=#333333 size="3" >在MyProduct商品列表，商品根据最后操作时间排序，最后操作时间越接近当前时间越靠前。</font>

3. 商品上架：<font color=#333333 size="3" >在商品上架时可选是否上架到Online Store Channel，是的话直接上架到Channel，否则只发布到Shopify不上架到Channel，提示如下图</br><div align=center>![-w593](media/15524743733115/15528768180290.jpg)
<center><font size="2" color=#666666>提示</font></center> </div></br>流程如下示意图</font></br><div align=center>![-w450](media/15524743733115/15525491109269.jpg) 
    <center><font size="2" color=#666666>示意图</font></center>
    </div>   
1. 商品的下架：商品在上架后在DSers平台不可下架，不可编辑。当商品在Shopify被删除时，DSers通过Webhook将该商品在DSers的状态变为下架状态（未发布状态）

2. 商品变更与同步：<font color=#333333 size="3" >当Shopify商品变更时，会覆盖DSers的商品变更，DSers变更因为只能修改未发布的商品，不会冲突</font>

3. 商品的删除：<font color=#333333 size="3" >~~在Shopify删除的商品不会导致在DSers上的商品被删除，但是会导致这个商品在DSers变成未发布状态，在DSers上删除商品时会提示用户是否一起删除Shopify的商品，删除不可恢复。~~</br><font color=#333333 size="3" >提示是否删除，与现有删除功能一致</font><div align=center>![-w551](media/15524743733115/15531720905503.jpg)

<center><font size="2" color=#666666>删除商品确认</font></center>

1. 商品信息的抓取：商品的供应商SKU变更、SKU价格变更（Cost）、库存变更，会变更商品在DSers上的相关信息，如果供应商的SKU被删除或改变至无法对应，将这个SKU的库存设置为0。

2. 商品价格与Pricing Rule：可设置全局、单独商品在供应商价格变动后是否根据规则改价

### PRD

<font color=#333333 size="3" >此次修改涉及到:
- 商品上下架规则
~~- 商品删除逻辑变更~~
- MyProduct 列表
- 商品编辑功能改版
- Pricing Rule规则修改
</font>

##### 商品上下架规则
<font color=#333333 size="3" >
1. 商品分为已发布（上架），未发布（下架）两种情况</br>
2. 上架指商品已在Shopify上发布，或已经发布到Shopify的Online Channel。</br>
3. 未发布的商品指还没有发布到Shopify的商品</br>
4. 已经发布到Shopify的商品不可以从DSers触发从Shopify下架</br>
5. 如果商品在Shopify删除，通过webhook获取到商品在Shopify删除后，将该商品在DSers标记为未发布状态，不删除。</br></font>

##### MyProduct 列表
<font color=#333333 size="3" >
1. MyProduct 列表中的商品卡片，商品编辑入口位置如图</br><div align=center>![-w450](media/15524743733115/15525478545405.jpg)
<center><font size="2" color=#666666>编辑商品入口</font></center>
</div></br>功能：点击判断商品当前状态，A. 未发布状态，进入商品编辑界面。B. 已发布状态，进入商品信息查看界面。</br>打开位置：触发编辑/查看后在当前页面打开商品编辑/查看界面

1. MyProduct列表中增加全选和批量操作项，如下图:
<div align=center>![-w683](media/15524743733115/15528774980547.jpg)
<center><font size="2" color=#666666>全选及操作</font></center></div></br>全选：点击后全选本页所有商品，不跨页选择，切换页面/页数/刷新都会导致选择丢失。</br>批量操作项:Publish批量发布,Delete批量删除；批量删除时弹出框与单个商品删除提示一致，如图<div align=center>![-w551](media/15524743733115/15531721343402.jpg)
<center><font size="2" color=#666666>删除商品确认</font></center></div><font color=#666666 size="2"></br>卡片字段说明：
>
| 字段 | 来源 |
| --- | --- |
| 图片 | 商品头图 |
| 1、商品标题 | 商品Changed Title |
| 2、Cost | 商品内所有SKU在AliExpress售价范围，如有修改实时变更</br>例如Cost: 20.99~22.99/piece，</br>如果商品SKU售价相同，显示一个价格即可，</br>如果商品是Other商品，显示为 Cost: -- </br>当商品从Other转换成Ali商品,或商品更换供应商时，更新显示信息 |
| 3、Price | 商品内所有SKU在Shopify的售价范围，</br>如果商品SKU售价相同，显示一个价格即可，Price价格理论上不会为空</br>~~当商品从Other转换成Ali商品,或商品更换供应商时，更新显示信息~~|
| 4、星级 | 商品在AliExpress的供应商评分等级</br>当商品从Other转换成Ali商品,或商品更换供应商时，更新显示信息，默认0。 |
| 5、Orders | 商品在AliExpress被购买的次数</br>当商品从Other转换成Ali商品,或商品更换供应商时，更新显示信息,默认为0。 |
| 6、Stock | 取商品SKU里面库存最多的显示</br>当商品从Other转换成Ali商品,或商品更换供应商时，更新显示信息。 |

</br><div align=center>![-w458](media/15524743733115/15528802722523.jpg)
<center><font size="2" color=#666666>商品卡片</font></center></div>
</font>

##### 商品编辑功能改版
<font color=#333333 size="3" >
点击编辑商品后进入编辑商品页面样式如图：
<div align=center>![-w1201](media/15524743733115/15528972354341.jpg)
<center><font size="2" color=#666666>1.1 编辑product</font></center></div>
<div align=center>![-w1191](media/15524743733115/15528975714242.jpg)
<center><font size="2" color=#666666>1.2 编辑Variants</font></center></div>
<div align=center>![-w1197](media/15524743733115/15528980532498.jpg)
<center><font size="2" color=#666666>1.3 编辑Description</font></center></div>
<div align=center>![-w1197](media/15524743733115/15529003800444.jpg)
<center><font size="2" color=#666666>1.4 编辑Images</font></center></div>

商品查看页面样式：
<div align=center>![-w1199](media/15524743733115/15528971457131.jpg)

<center><font size="2" color=#666666>图2-1 Product查看</font></center></div>
<div align=center>![-w1193](media/15524743733115/15528990269805.jpg)

<center><font size="2" color=#666666>图2-2 Variants查看</font></center></div>
<div align=center>![-w1198](media/15524743733115/15528993002123.jpg)
<center><font size="2" color=#666666>图2-3 Description查看</font></center></div>
<div align=center>
![-w1196](media/15524743733115/15528994295767.jpg)
<center><font size="2" color=#666666>图2-4 Images查看</font></center></div>

###### Product：
全局：
1. Tab标签。可对商品进行编辑的项目，包括：基本信息-product，Variants信息-Variants，商品描述-Description，商品图片-Images
 
2. 商品操作。包括：商品发布 - Publish to Shopify 发布当前商品到Shopify，发布前置会进行一次保存动作；~~Setting Mapping - 配置供应商~~（Mapping只在查看时存在，编辑时不存在）；商品删除 - Delete，同MyProduct-商品卡片中的删除。 
 
3. save按钮。对当前商品信息进行保存。
<div align=center>![-w1204](media/15524743733115/15528969094499.jpg)
<center><font size="2" color=#666666>图1-1 编辑product</font></center></div>

![-w1204](media/15524743733115/15528998071312.jpg)
<center><font size="2" color=#666666>product</font></center>

 1. 商品图片</br>来源：分为两种来源；1-从shopify导入的商品，来自Shopify商品头图字段，2-从DSers上新的商品，来自AliExpress的头图字段。</br>功能：点击弹出该商品的图片库弹窗，可以选择图片替换。
 2. Original Title，商品原始标题：</br>来源：1、从DSers上新的商品，是导入时AliExpress商品的标题。 2、从Shopify导入的商品，是导入时Shopify的商品标题。</br>功能：如果是AliExpress商品或绑定了AliExpress供应商，点击可跳转至对应AliExpress商品界面。
 3. 供应商信息</br>来源： 1、如果是AliExpress商品，显示为：from AliExpress（卖家ID），2、如果是other商品显示为：from Other。
 4. Change Title：</br>来源：初始默认显示Original Title的数据，改动保存后显示改动后的信息。</br>功能：可修改，长度最大225，对应Shopify的商品Title字段。
 5. Product Type：</br>来源：shopify的Product Type，（需打通Product Type字段）
 6. Vendor：</br>来源：shopify的Vendor字段，（需打通Vendor字段）
 7. Collections：</br>来源：shopify的Collections字段，（需打通Collections字段）
 8. Tags：</br>来源：shopify的Tags字段，一个商品可输入多个，回车或','分割，分割后参照样式如图：</br>![-w545](media/15524743733115/15531715288027.jpg)

 9. 提示信息：</br>涉及商品的一些提示信息会显示在这里 
 
###### Variants：
![-w1194](media/15524743733115/15528998950960.jpg)
<center><font size="2" color=#666666>Variants</font></center>
 1. Select Variants ：</br>与现有Variants选择功能一致。</br>
 2. Variants列表，内部可横竖滚动：</br> 来源：导入商品的Variants列表。</br>表头说明：1、复选框，全选/取消选择Variant；2、Action：批量操作项，与复选框联动，批量处理已选择的Variants，</br>Action操作：</br> <font color=#666666 size="2">
>
Change Price 批量修改价格</br>Change Compare at Price 批量修改原价</br>Change Color 以实际Option value为准,批量修改</br>Change Size以实际Option value为准批量修改</br>Remove SKU 批量删除选择的SKU</br>Duplicate in another 'Option'：复制SKU，参照现有功能 Option对应商品的Option Name，有多个的时候多一项操作，最多三个。</br>
</font>

列表字段说明：
![-w761](media/15524743733115/15526373575378.jpg)
<center><font size="2" color=#666666>Sku 列表</font></center>
> <font color=#666666 size="1">
| 字段（从左至右） | 类型 | 来源 | 功能说明 |
| --- | --- | --- | --- |
| SKU图片缩略图 | 图片 | 商品SKU对应的图片 | 点击图片可放大，参照订单列表图片放大 |
| SKU | 字符串 | 初始为商品在AliExpress</br>或Shopify同步过来的的SKU Name | 可修改,<font color=red>如果商品SKU为空，填入：Default </fount>|
| Option1 | 字符串 | 初始为AliExpress</br>或Shopify同步过来的Option1| 可修改，</br>OptionValue在DSers平台表现为</br>最多只可显示/修改3个Option Value，</br>如果商品的option大大于3，将多出的Option name填到Option3的Option中 </br>如：option 3 /Option 4/ OPtion 5，</br>将多出的Option Value填到Option Value 3中，</br>如：Value 3 /Value 4 /Value 5 ；</br>修改时视为修改Option3的内容|
| Option 2 |  |  |  |
| Option 3 |  |  |  |
| Cost | 小数，精确2位 | AliExpress的商品折后价</br>Shopify同步过来商品的售价/br>当商品更换供应商时更新价格 | 不可修改，AE商品数据变更后更新字段 |
| Price | 小数，精确2位 | AliExpress的商品折后价</br>Shopify同步过来商品的售价 | 可修改，只能填数字，保留2位小数，在没有上架时根据Pricing Rule和用户设置更新 |
| Compare Price | 小数，精确2位 | 默认为Price数值 | 可修改，只能填数字，保留2位小数，在没有上架时根据Pricing Rule和用户设置更新 |
| Stock | 整数 | 初始为AliExpress</br>或Shopify同步过来的库存 | 可修改，只能填整数,AE商品数据变更后更新字段 |
| 操作 | -- | -- | 删除SKU，触发给出提示，删除后不可恢复 |
</font>

###### Description
![-w1197](media/15524743733115/15528980532498.jpg)
<center><font size="2" color=#666666>1.3 编辑Description</font></center>
使用现有富文本编辑工具，需支持HTML编辑。

###### Images

![-w1197](media/15524743733115/15529003800444.jpg)
<center><font size="2" color=#666666>Images</font></center>

1. 图片库定义：</br>每个商品有一个图片库，这些图片会在发布商品时被一起发布到Shopify，图片库初始数据来源是从AliExpress同步过来的图片。
2. 下载图片：</br>通过Download按钮可以批量下载图片，下载时是将图片打包成.zip文件下载。将鼠标移动到某个图片上会出现操作按钮，其中下载按钮可以下载单张图片。
3. ~~上传图片：</br>支持单张上传、批量上传，将外部图片导入到该商品的图片库，并在Images里显示。~~
4. 图片库详细：</br>1、图片列表中标记有外框+对号图标的表示该图片正在被使用，并会在发布到Shopify的时候同步到Shopify，其他没标记的不会被同步到shopify。2、头图展示在第一个位置。3、图片在鼠标滑过时显示蒙层和操作图标：查看：点击查看大图、~~编辑：使用第三方API工具编辑图片、~~下载：下载图片。
5. ~~第三方API：PhotoShop 在线编辑组件 API</br>API地址：</br>https://www.adobe.io/apis/creativecloud/creativesdk/docs/websdk.html#!getting-started.md~~
</font>

##### Pricing Rule
TODO 完善中...
更改Pricing Rule：
增加开关控制自动改价：</br>1、Setting - pricing rule增加开关，默认关闭，开启时会在商品供应商售价改变后根据Pricing Rule更新商品的Price和compare at price。![-w554](media/15524743733115/15531746951289.jpg)
![-w550](media/15524743733115/15531747080595.jpg)
</br>2、开关开启弹出提示，提示用户这将会影响所有商品的价格改变，并会覆盖至Shopify的商品出售价格，是否确认开启，如果想部分商品实时改变，可以在商品详情中单独开启。![-w924](media/15524743733115/15531750862489.jpg)
</br>3、关闭时：不改变其他价格，只改变cost。</br>4、在开关关闭时自动触发改价的情况：商品上新、首次绑定供应商。

